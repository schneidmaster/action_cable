var ConnectionMonitor,bind=function(t,n){return function(){return t.apply(n,arguments)}};ConnectionMonitor=function(){function t(t){this.connection=t,this.visibilityDidChange=bind(this.visibilityDidChange,this),this.reconnectAttempts=0}var n,e,i;return t.pollInterval={min:3,max:30},t.staleThreshold=6,t.prototype.start=function(){return this.isRunning()?void 0:(this.startedAt=e(),delete this.stoppedAt,this.startPolling(),document.addEventListener("visibilitychange",this.visibilityDidChange))},t.prototype.stop=function(){return this.isRunning()?(this.stoppedAt=e(),this.stopPolling(),document.removeEventListener("visibilitychange",this.visibilityDidChange)):void 0},t.prototype.isRunning=function(){return null!=this.startedAt&&null==this.stoppedAt},t.prototype.recordPing=function(){return this.pingedAt=e()},t.prototype.recordConnect=function(){return this.reconnectAttempts=0,this.recordPing(),delete this.disconnectedAt},t.prototype.recordDisconnect=function(){return this.disconnectedAt=e()},t.prototype.startPolling=function(){return this.stopPolling(),this.poll()},t.prototype.stopPolling=function(){return clearTimeout(this.pollTimeout)},t.prototype.poll=function(){return this.pollTimeout=setTimeout(function(t){return function(){return t.reconnectIfStale(),t.poll()}}(this),this.getPollInterval())},t.prototype.getPollInterval=function(){var t,e,i,o;return o=this.constructor.pollInterval,i=o.min,e=o.max,t=5*Math.log(this.reconnectAttempts+1),Math.round(1e3*n(t,i,e))},t.prototype.reconnectIfStale=function(){return this.connectionIsStale()&&(this.reconnectAttempts++,!this.disconnectedRecently())?this.connection.reopen():void 0},t.prototype.connectionIsStale=function(){var t;return i(null!=(t=this.pingedAt)?t:this.startedAt)>this.constructor.staleThreshold},t.prototype.disconnectedRecently=function(){return this.disconnectedAt&&i(this.disconnectedAt)<this.constructor.staleThreshold},t.prototype.visibilityDidChange=function(){return"visible"===document.visibilityState?setTimeout(function(t){return function(){return t.connectionIsStale()||!t.connection.isOpen()?t.connection.reopen():void 0}}(this),200):void 0},e=function(){return(new Date).getTime()},i=function(t){return(e()-t)/1e3},n=function(t,n,e){return Math.max(n,Math.min(e,t))},t}(),module.exports=ConnectionMonitor;