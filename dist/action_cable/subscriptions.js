var Subscription,Subscriptions,slice=[].slice;Subscription=require("./subscription"),Subscriptions=function(){function t(t){this.consumer=t,this.subscriptions=[]}return t.prototype.create=function(t,i){var n,r,s;return n=t,r="object"==typeof n?n:{channel:n},s=new Subscription(this.consumer,r,i),this.add(s)},t.prototype.add=function(t){return this.subscriptions.push(t),this.consumer.ensureActiveConnection(),this.notify(t,"initialized"),this.sendCommand(t,"subscribe"),t},t.prototype.remove=function(t){return this.forget(t),this.findAll(t.identifier).length||this.sendCommand(t,"unsubscribe"),t},t.prototype.reject=function(t){var i,n,r,s,e;for(r=this.findAll(t),s=[],i=0,n=r.length;n>i;i++)e=r[i],this.forget(e),this.notify(e,"rejected"),s.push(e);return s},t.prototype.forget=function(t){var i;return this.subscriptions=function(){var n,r,s,e;for(s=this.subscriptions,e=[],n=0,r=s.length;r>n;n++)i=s[n],i!==t&&e.push(i);return e}.call(this),t},t.prototype.findAll=function(t){var i,n,r,s,e;for(r=this.subscriptions,s=[],i=0,n=r.length;n>i;i++)e=r[i],e.identifier===t&&s.push(e);return s},t.prototype.reload=function(){var t,i,n,r,s;for(n=this.subscriptions,r=[],t=0,i=n.length;i>t;t++)s=n[t],r.push(this.sendCommand(s,"subscribe"));return r},t.prototype.notifyAll=function(){var t,i,n,r,s,e,o;for(i=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],s=this.subscriptions,e=[],n=0,r=s.length;r>n;n++)o=s[n],e.push(this.notify.apply(this,[o,i].concat(slice.call(t))));return e},t.prototype.notify=function(){var t,i,n,r,s,e,o;for(e=arguments[0],i=arguments[1],t=3<=arguments.length?slice.call(arguments,2):[],o="string"==typeof e?this.findAll(e):[e],s=[],n=0,r=o.length;r>n;n++)e=o[n],s.push("function"==typeof e[i]?e[i].apply(e,t):void 0);return s},t.prototype.sendCommand=function(t,i){var n;return n=t.identifier,this.consumer.send({command:i,identifier:n})},t}(),module.exports=Subscriptions;